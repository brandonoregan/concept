{% load static %}

<!-- Banner Row -->
<div class="row messageDisplayBannerRow">
    <!-- Profile Picture Col -->
    <div class="col">
        {% if most_recent_message.sender.profile.profile_picture %}
            <img src="{{ display_message.sender.profile.profile_picture.url }}" alt="Sender Profile Picture">
            {% else %}
            <img src="{% static 'images/no-image.jpg' %}" alt="No image">
        {% endif %}
    </div>
    <!-- User Information -->
    <div class="col">
        {% if most_recent_message %}
        <h3>{{ most_recent_message.sender }}</h3>
        {% elif selected_user %}
        <h3>{{ selected_user }}</h3>
        {% endif %}
    </div>
</div>
<!-- Display Message Content and History -->
<div class="row convoContainer">
    <div class="col">
            <!-- If there is a conversation beween current user and the searched user from search bar. -->
            {% if conversation %}
                {% for message in conversation %}
                    {% if message.sender == current_user %}
                        <div class="border messageGreen text-end w-100 ms-auto">
                            <p class="convoSenderGreen">{{ message.sender }}</p>
                            <p class="convoContentGreen">{{ message.content }}</p>
                            {% if message.sent_at|time:"H" < "12" %}
                                <p class='convoTimeGreen'>{{ message.sent_at|time:"h:i A" }}</p>
                            {% else %}
                                <p>{{ message.sent_at|time:"h:i A" }}</p>
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="border messageBlue">
                            <p class="convoSender">{{ message.sender }}</p>
                            <p class="convoContent">{{ message.content }}</p>
                            {% if message.sent_at|time:"H" < "12" %}
                                <p class='convoTime'>{{ message.sent_at|time:"h:i A" }}</p>
                            {% else %}
                                <p>{{ message.sent_at|time:"h:i A" }}</p>
                            {% endif %}
                        </div>
                    {% endif %}
                {% endfor %}
            {% else %}
                <div class="border messageGreen text-end w-100 ms-auto">
                    <p class="convoSenderGreen">{{ selected_user.username }}</p>
                    <p class="convoContentGreen">Be the first to say hello</p>
                    <p class='convoTimeGreen'>Now</p>
                </div>
            {% endif %}

        <!-- TODO For each message in messages where sender and reciver are equal, in order of date create a tab representing a message -->
    </div>
</div>
<!-- Reply Form -->
<div class="row">
    <div class="col replyMessage">
            <form method="post" action="{% url 'reply_message' %}" class="form-container">
                {% csrf_token %}
                <textarea name="message" placeholder="Enter your message"></textarea>
                <button type="submit" class="btn btn-primary">Send</button>
            </form>
    </div>
</div>